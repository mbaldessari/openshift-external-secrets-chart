suite: Test external-secrets config
templates:
  - templates/external-secret-config.yaml
release:
  name: release-test
tests:
  - it: should create ExternalSecretsConfig with default values
    asserts:
      - hasDocuments:
          count: 1
      - isKind:
          of: ExternalSecretsConfig
      - equal:
          path: apiVersion
          value: operator.openshift.io/v1alpha1
      - equal:
          path: metadata.name
          value: cluster
      - equal:
          path: metadata.labels["app.kubernetes.io/name"]
          value: external-secrets-operator

  - it: should configure network policies for vault access
    asserts:
      - equal:
          path: spec.controllerConfig.networkPolicies[0].name
          value: allow-vault-access
      - equal:
          path: spec.controllerConfig.networkPolicies[0].componentName
          value: ExternalSecretsCoreController
      - equal:
          path: spec.controllerConfig.networkPolicies[0].egress[0].ports[0].protocol
          value: TCP
      - equal:
          path: spec.controllerConfig.networkPolicies[0].egress[0].ports[0].port
          value: 443